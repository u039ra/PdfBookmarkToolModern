<Window x:Class="PdfBookmarkToolModern.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:PdfBookmarkToolModern.Converters"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}" 
        Height="600" Width="1000"
        MinHeight="400" MinWidth="800">
    
    <Window.Resources>
        <!-- Converters -->
        <converters:GoToRVisibilityConverter x:Key="GoToRVisibilityConverter"/>
        <converters:NullOrEmptyToVisibilityConverter x:Key="NullOrEmptyToVisibilityConverter"/>
        
        <!-- TreeViewç”¨ã®HierarchicalDataTemplate -->
        <HierarchicalDataTemplate x:Key="BookmarkTemplate" ItemsSource="{Binding Children}">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding Title}" 
                          ToolTip="{Binding DisplayText}"
                          FontWeight="{Binding Level, Converter={x:Static converters:LevelToFontWeightConverter.Instance}}"
                          Margin="2"/>
            </StackPanel>
        </HierarchicalDataTemplate>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ -->
        <Menu Grid.Row="0">
            <MenuItem Header="ãƒ•ã‚¡ã‚¤ãƒ«(_F)">
                <MenuItem Header="PDFã‚’é–‹ã(_O)" Command="{Binding LoadPdfCommand}"/>
                <MenuItem Header="ãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯ã‚’ãƒã‚§ãƒƒã‚¯(_C)" Command="{Binding CheckBookmarksCommand}"/>
                <Separator/>
                <MenuItem Header="Excelã‹ã‚‰èª­ã¿è¾¼ã¿(_I)" Command="{Binding LoadFromExcelCommand}"/>
                <MenuItem Header="Excelã«ä¿å­˜(_E)" Command="{Binding SaveToExcelCommand}"/>
                <Separator/>
                <MenuItem Header="PDFã«æ›¸ãè¾¼ã¿(_W)" Command="{Binding WriteToPdfCommand}"/>
                <MenuItem Header="ãƒ•ã‚©ãƒ«ãƒ€å†…ã®PDFã«ä¸€æ‹¬æ›¸ãè¾¼ã¿(_B)" Command="{Binding WriteToBatchPdfCommand}"/>
                <Separator/>
                <MenuItem Header="çµ‚äº†(_X)" Click="ExitMenuItem_Click"/>
            </MenuItem>
            <MenuItem Header="ç·¨é›†(_E)">
                <MenuItem Header="å…ƒã«æˆ»ã™(_U)" Command="{Binding UndoCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="â†¶" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="ã‚„ã‚Šç›´ã—(_R)" Command="{Binding RedoCommand}">
                    <MenuItem.Icon>
                        <TextBlock Text="â†·" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="ãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯ã‚’è¿½åŠ (_A)" Command="{Binding AddBookmarkCommand}"/>
                <MenuItem Header="ãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯ã‚’å‰Šé™¤(_D)" Command="{Binding DeleteBookmarkCommand}"/>
                <MenuItem Header="å¤‰æ›´ã‚’é©ç”¨(_P)" Command="{Binding ApplyChangesCommand}"/>
            </MenuItem>
            <MenuItem Header="ãƒ„ãƒ¼ãƒ«(_T)">
                <MenuItem Header="è¨­å®š(_S)" Command="{Binding ShowSettingsCommand}"/>
            </MenuItem>
        </Menu>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="2*"/>
            </Grid.ColumnDefinitions>

            <!-- å·¦å´ãƒ‘ãƒãƒ«: ãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯éšŽå±¤è¡¨ç¤º -->
            <Border Grid.Column="0" Style="{StaticResource AnimatedCardStyle}">
                <Grid Style="{StaticResource FadeInStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                <!-- ãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯æ“ä½œãƒœã‚¿ãƒ³ã¨æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ -->
                <StackPanel Grid.Row="0" Margin="0,0,0,10">
                    <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <Button Content="âž• è¿½åŠ " Command="{Binding AddBookmarkCommand}" 
                                Style="{StaticResource AnimatedButtonStyle}"
                                Background="{StaticResource SecondaryBrush}"
                                ToolTip="æ–°ã—ã„ãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯ã‚’è¿½åŠ "/>
                        <Button Content="ðŸ—‘ï¸ å‰Šé™¤" Command="{Binding DeleteBookmarkCommand}" 
                                Style="{StaticResource AnimatedButtonStyle}"
                                Background="{StaticResource AccentBrush}"
                                ToolTip="é¸æŠžã—ãŸãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯ã‚’å‰Šé™¤"/>
                        <Button Content="âœ… é©ç”¨" Command="{Binding ApplyChangesCommand}" 
                                Style="{StaticResource AnimatedButtonStyle}"
                                ToolTip="å¤‰æ›´ã‚’é©ç”¨"/>
                    </StackPanel>
                    
                    <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                    <Expander Header="ðŸ” æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿" IsExpanded="False" Margin="0,5,0,0">
                        <StackPanel Margin="10,5,0,0">
                            <!-- æ¤œç´¢ãƒ†ã‚­ã‚¹ãƒˆ -->
                            <Grid Margin="0,0,0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="æ¤œç´¢:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <TextBox Grid.Column="1" 
                                        Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                                        Style="{StaticResource AnimatedTextBoxStyle}"
                                        ToolTip="ãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯ã®ã‚¿ã‚¤ãƒˆãƒ«ã§æ¤œç´¢"
                                        Margin="0,0,5,0"/>
                                <Button Grid.Column="2" Content="âœ•" 
                                       Command="{Binding ClearFiltersCommand}"
                                       Style="{StaticResource AnimatedButtonStyle}"
                                       Background="{StaticResource AccentBrush}"
                                       ToolTip="ãƒ•ã‚£ãƒ«ã‚¿ã‚’ã‚¯ãƒªã‚¢"
                                       Width="30" Height="30"
                                       FontSize="14"
                                       Padding="0"
                                       Margin="0,0,0,0"/>
                            </Grid>
                            
                            <!-- ãƒ¬ãƒ™ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ -->
                            <Grid Margin="0,0,0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="ãƒ¬ãƒ™ãƒ«:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <ComboBox Grid.Column="1" 
                                         SelectedItem="{Binding SelectedLevel}"
                                         ItemsSource="{Binding LevelFilterOptions}"
                                         ToolTip="0=ã™ã¹ã¦ã®ãƒ¬ãƒ™ãƒ«"/>
                            </Grid>
                            
                            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ«ã‚¿ -->
                            <Grid Margin="0,0,0,5">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="ã‚¿ã‚¤ãƒ—:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                <ComboBox Grid.Column="1" 
                                         SelectedItem="{Binding SelectedActionType}"
                                         ItemsSource="{Binding ActionTypeFilterOptions}"
                                         ToolTip="ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—ã§ãƒ•ã‚£ãƒ«ã‚¿"/>
                            </Grid>
                        </StackPanel>
                    </Expander>
                </StackPanel>

                <!-- ãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ -->
                <Grid Grid.Row="1">
                    <TreeView x:Name="BookmarkTreeView" 
                        ItemsSource="{Binding Bookmarks}"
                        SelectedItemChanged="BookmarkTreeView_SelectedItemChanged"
                        AllowDrop="True"
                        PreviewMouseDown="TreeView_PreviewMouseDown"
                        PreviewMouseMove="TreeView_PreviewMouseMove"
                        DragOver="TreeView_DragOver"
                        Drop="TreeView_Drop"
                        PreviewMouseRightButtonDown="TreeViewItem_PreviewMouseRightButtonDown"
                        DragLeave="TreeView_DragLeave">
                        <TreeView.ItemTemplate>
                            <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Title}" Margin="2"/>
                                </StackPanel>
                            </HierarchicalDataTemplate>
                        </TreeView.ItemTemplate>
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="TreeViewItem" BasedOn="{StaticResource AnimatedTreeViewItemStyle}">
                                <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
                                <Setter Property="IsExpanded" Value="{Binding IsExpanded, Mode=TwoWay}"/>
                                <EventSetter Event="PreviewMouseRightButtonDown" Handler="TreeViewItem_PreviewMouseRightButtonDown"/>
                            </Style>
                        </TreeView.ItemContainerStyle>
                    </TreeView>
                    <Canvas x:Name="DropIndicatorCanvas" Panel.ZIndex="1"/>
                </Grid>

                    <!-- çµ±è¨ˆæƒ…å ± -->
                    <TextBlock Grid.Row="2" 
                              Text="{Binding Bookmarks.Count, StringFormat='ãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯æ•°: {0}'}"
                              Margin="0,5,0,0"
                              HorizontalAlignment="Right"/>
                </Grid>
            </Border>

            <!-- ã‚¹ãƒ—ãƒªãƒƒã‚¿ãƒ¼ -->
            <GridSplitter Grid.Column="1" 
                         Background="LightGray" 
                         HorizontalAlignment="Stretch"/>

            <!-- å³å´ãƒ‘ãƒãƒ«: ãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯è©³ç´°ç·¨é›† -->
            <Border Grid.Column="2" Style="{StaticResource AnimatedCardStyle}" Margin="10,0,0,0">
                <Grid DataContext="{Binding SelectedBookmark}" Style="{StaticResource FadeInStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                <TextBlock Grid.Row="0" 
                          Text="ãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯è©³ç´°ç·¨é›†" 
                          FontSize="16" 
                          FontWeight="Bold" 
                          Margin="0,0,0,10"/>

                <!-- è©³ç´°ç·¨é›†ãƒ‘ãƒãƒ« -->
                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                    <StackPanel IsEnabled="{Binding RelativeSource={RelativeSource AncestorType=Grid}, Path=DataContext, Converter={StaticResource NullOrEmptyToVisibilityConverter}}">
                        
                        <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
                        <Label Content="ã‚¿ã‚¤ãƒˆãƒ«:"/>
                        <TextBox Text="{Binding Title, UpdateSourceTrigger=PropertyChanged}" 
                                Style="{StaticResource AnimatedTextBoxStyle}"
                                AcceptsReturn="False"/>

                        <!-- ãƒ¬ãƒ™ãƒ« -->
                        <Label Content="ãƒ¬ãƒ™ãƒ«:"/>
                        <TextBox Text="{Binding Level, UpdateSourceTrigger=PropertyChanged}"
                                Style="{StaticResource AnimatedTextBoxStyle}"
                                IsReadOnly="True"
                                Background="LightGray"/>

                        <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ— -->
                        <Label Content="ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—:"/>
                        <ComboBox SelectedItem="{Binding ActionType, UpdateSourceTrigger=PropertyChanged}"
                                 ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.ActionTypes}"/>

                        <!-- ãƒªãƒ³ã‚¯å…ˆãƒ•ã‚¡ã‚¤ãƒ« (GoToRã®å ´åˆã®ã¿è¡¨ç¤º) -->
                        <Label Content="ãƒªãƒ³ã‚¯å…ˆãƒ•ã‚¡ã‚¤ãƒ«:"
                              Visibility="{Binding ActionType, Converter={StaticResource GoToRVisibilityConverter}}"/>
                        <TextBox Text="{Binding LinkFile, UpdateSourceTrigger=PropertyChanged}"
                                Style="{StaticResource AnimatedTextBoxStyle}"
                                Visibility="{Binding ActionType, Converter={StaticResource GoToRVisibilityConverter}}"/>

                        <!-- ãƒšãƒ¼ã‚¸ç•ªå· -->
                        <Label Content="ãƒšãƒ¼ã‚¸ç•ªå·:"/>
                        <TextBox Text="{Binding LinkPage, UpdateSourceTrigger=PropertyChanged}"
                                Style="{StaticResource AnimatedTextBoxStyle}"/>

                        <!-- è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
                        <Label Content="è¡¨ç¤ºã‚ªãƒ—ã‚·ãƒ§ãƒ³:"/>
                        <ComboBox SelectedItem="{Binding DisplayOption, UpdateSourceTrigger=PropertyChanged}"
                                 ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.DisplayOptions}"/>

                        <!-- Xåº§æ¨™ (XYZã®å ´åˆã®ã¿è¡¨ç¤º) -->
                        <Label Content="Xåº§æ¨™:"
                              Visibility="{Binding DisplayOption, Converter={StaticResource ActionTypeToVisibilityConverter}, ConverterParameter=XYZ}"/>
                        <TextBox Text="{Binding XCoord, UpdateSourceTrigger=PropertyChanged}"
                                Style="{StaticResource AnimatedTextBoxStyle}"
                                Visibility="{Binding DisplayOption, Converter={StaticResource ActionTypeToVisibilityConverter}, ConverterParameter=XYZ}"/>

                        <!-- Yåº§æ¨™ (XYZã®å ´åˆã®ã¿è¡¨ç¤º) -->
                        <Label Content="Yåº§æ¨™:"
                              Visibility="{Binding DisplayOption, Converter={StaticResource ActionTypeToVisibilityConverter}, ConverterParameter=XYZ}"/>
                        <TextBox Text="{Binding YCoord, UpdateSourceTrigger=PropertyChanged}"
                                Style="{StaticResource AnimatedTextBoxStyle}"
                                Visibility="{Binding DisplayOption, Converter={StaticResource ActionTypeToVisibilityConverter}, ConverterParameter=XYZ}"/>

                        <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                        <Label Content="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼:" Margin="0,10,0,0"/>
                        <Border BorderBrush="LightGray" BorderThickness="1" Padding="5" Background="LightYellow">
                            <TextBlock Text="{Binding DisplayText}" 
                                      TextWrapping="Wrap"
                                      MaxHeight="100"
                                      VerticalAlignment="Top"/>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ -->
        <StatusBar Grid.Row="2">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <Border Style="{StaticResource LoadingSpinnerStyle}"
                            Width="20" Height="20"
                            Visibility="{Binding IsProcessing, Converter={x:Static converters:BooleanToVisibilityConverter.Instance}}"/>
                    <TextBlock Text="å‡¦ç†ä¸­..." 
                              Margin="8,0,0,0"
                              FontWeight="Medium"
                              Visibility="{Binding IsProcessing, Converter={x:Static converters:BooleanToVisibilityConverter.Instance}}"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window> 